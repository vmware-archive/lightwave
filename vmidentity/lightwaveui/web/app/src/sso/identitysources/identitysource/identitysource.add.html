<!--

 * Copyright © 2012-2016 VMware, Inc.  All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the “License”); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an “AS IS” BASIS, without
 * warranties or conditions of any kind, EITHER EXPRESS OR IMPLIED.  See the
 * License for the specific language governing permissions and limitations
 * under the License.

-->

<div class="popup-container">
    <div class="header-20px">
        Add New Identity Source
    </div>
    <div class='error' ng-show="globals.popup_errors && !globals.popup_errors.success">
        <img src="../app/assets/error.png" width="16px" height="16px"/>
        <button type="button"
                class="btn btn-xs btn-link pull-right"
                ng-click="globals.popup_errors = null;">X
        </button>
        {{globals.popup_errors.details}} {{globals.popup_errors.cause}}
    </div>
    <div class='success' ng-show="globals.popup_errors && globals.popup_errors.success">
        <img src="../app/assets/success.png" width="16px" height="16px"/>
        <button type="button"
                class="btn btn-xs btn-link pull-right"
                ng-click="globals.popup_errors = null;">X
        </button>
        {{globals.popup_errors.details}}
    </div>
    <div class="row">
        <form name="newuserform"
              ng-submit="vm.addIdentitySource(vm.newIdentitySource)"
              role="form">
            <div class="row content popup-content">

                <div class="small-navigation" ng-show="vm.isNew">
                    <div class="small-navigation-item">
                        <span ng-show="vm.idsTab != 0;">Choose Type</span>
                        <strong ng-show="vm.idsTab == 0;">Choose Type</strong>
                    </div>
                    <div class="small-navigation-item">
                        <span ng-show="vm.idsTab != 1;">Basic Details</span>
                        <strong ng-show="vm.idsTab == 1;">Basic Details</strong>
                    </div>
                    <div ng-show="vm.isSecure() || vm.isNewSecure()"
                         class="small-navigation-item">
                        <span ng-show="vm.idsTab != 2">Certificate(s)</span>
                        <strong ng-show="vm.idsTab == 2">Certificate(s)</strong>
                    </div>
                    <div class="small-navigation-item">
                        <span ng-show="vm.idsTab != 3;">Credentials</span>
                        <strong ng-show="vm.idsTab == 3;">Credentials</strong>
                    </div>
                    <div class="small-navigation-item">
                        <span ng-show="vm.idsTab != 4;">Summary</span>
                        <strong ng-show="vm.idsTab == 4;">Summary</strong>
                    </div>
                </div>

                <div class="policy-content"
                     ng-show="vm.idsTab == 0;">
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-12">
                            Choose the Type of Identity Source
                        </div>
                    </div>
                    <br/>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-12">
                            <input type="radio"
                                   name="identitySourceType"
                                   ng-click="vm.setIdentitySourceType(1)"
                                   autofocus="autofocus"
                                   ng-checked="vm.newIdentitySource.type == 'IDENTITY_STORE_TYPE_LDAP_WITH_AD_MAPPING'"/>
                            Active Directory as LDAP
                            <br/>

                        </div>
                    </div>
                    <br/>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-12">
                            <input type="radio"
                                   name="identitySourceType"
                                   ng-click="vm.setIdentitySourceType(2)"
                                   ng-checked="vm.newIdentitySource.type == 'IDENTITY_STORE_TYPE_LDAP'"/>
                            Open LDAP
                        </div>
                    </div>
                </div>
                <div class="policy-content"
                     ng-show="vm.idsTab == 1;">
                    <div class="popup-row col-xs-12" ng-show="vm.isNew">
                        <div class="col-xs-4">
                            Name
                        </div>
                        <div class="col-xs-8">
                            <input type="text"
                                   id="name"
                                   name="name"
                                   autofocus="autofocus"
                                   ng-model="vm.newIdentitySource.name"
                                   class="form-control pull-left"
                                   placeholder="Contoso"
                                   required/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Friendly Name
                        </div>
                        <div class="col-xs-8">
                            <input type="text"
                                   id="friendlyName"
                                   name="friendlyName"
                                   ng-model="vm.newIdentitySource.friendlyName"
                                   class="form-control pull-left"
                                   placeholder="Contoso"
                                   required/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Alias
                        </div>
                        <div class="col-xs-8">
                            <input type="text"
                                   id="alias"
                                   name="alias"
                                   ng-model="vm.newIdentitySource.alias"
                                   class="form-control pull-left"
                                   placeholder="Contoso Inc."
                                   required/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            User Base DN
                        </div>
                        <div class="col-xs-8">
                            <input type="text"
                                   id="userBaseDN"
                                   name="userBaseDN"
                                   ng-model="vm.newIdentitySource.userBaseDN"
                                   class="form-control pull-left"
                                   placeholder="cn=users, ou=contoso, ou=com"
                                   required/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Group Base DN
                        </div>
                        <div class="col-xs-8">
                            <input type="text"
                                   id="groupBaseDN"
                                   name="groupBaseDN"
                                   ng-model="vm.newIdentitySource.groupBaseDN"
                                   class="form-control pull-left"
                                   placeholder="cn=groups, ou=contoso, ou=com"
                                   required/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Primary Connection
                        </div>
                        <div class="col-xs-8">
                            <input type="text"
                                   id="connectionStrings_0"
                                   name="connectionStrings_0"
                                   ng-model="vm.newIdentitySource.connectionStrings[0]"
                                   class="form-control pull-left"
                                   placeholder="ldaps://contoso.com:236"
                                   required/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Secondary Connection
                        </div>
                        <div class="col-xs-8">
                            <input type="text"
                                   id="connectionStrings_1"
                                   name="connectionStrings_1"
                                   ng-model="vm.newIdentitySource.connectionStrings[1]"
                                   class="form-control pull-left"
                                   placeholder="ldaps://contoso.com:236" />
                        </div>
                    </div>
                </div>

                <div class="policy-content"
                     ng-show="vm.idsTab == 2;">
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Choose a certificate:
                        </div>
                        <div class="col-xs-4">
                            <input type="file"
                                   on-read-file="vm.addNewCertificate(contents)"
                                   id="certfilepath"
                                   name="encodedcertfilepath"
                                   ng-model="vm.certFilePath"/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-12">
                            <div ng-repeat="certificate in vm.newIdentitySource.certificates">
                                <button type="button"
                                        class="btn btn-link"
                                        ng-click="vm.viewCertificate(certificate)"
                                        uib-tooltip="{{certificate.metadata.subject}}"
                                        style="margin-left:-10px;word-wrap: break-word;word-break: break-all">
                                    {{
                                        certificate.metadata.subject.length> 45 ?
                                        certificate.metadata.subject.substring(0,45) + '...' :
                                        certificate.metadata.subject;
                                    }}
                                </button>
                                <button type="button"
                                        class="btn btn-link"
                                        ng-click="vm.removeCertificate(vm.newIdentitySource.certificates, certificate)"
                                        uib-tooltip="Remove"
                                        style="margin-left:-10px;word-wrap: break-word;word-break: break-all">X
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="policy-content"
                     ng-show="vm.idsTab == 3;">
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Username
                        </div>
                        <div class="col-xs-8">
                            <input type="text"
                                   id="username"
                                   name="username"
                                   autofocus="autofocus"
                                   ng-model="vm.newIdentitySource.username"
                                   class="form-control pull-left"
                                   placeholder="administrator"
                                   required/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Password
                        </div>
                        <div class="col-xs-8">
                            <input type="password"
                                   id="password"
                                   name="password"
                                   ng-model="vm.newIdentitySource.password"
                                   class="form-control pull-left"
                                   required/>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                        </div>
                        <div class="col-xs-8">
                            <button class="btn btn-xs btn-primary pull-right"
                                    type="button"
                                    ng-click="vm.testConnection(vm.newIdentitySource)"
                                    uib-tooltip="Test Connection"
                                    ng-disabled="!vm.isValid()"
                                    style="margin-right:10px;">
                                Test Connection
                            </button>
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-12">
                            <div ng-show="vm.isTestingConnection">
                                <img ng-if="vm.isTestingConnection"
                                     src="../app/assets/progress.gif"
                                     style="padding-right:10px;"/>
                                Testing connection ...
                            </div>
                            <div ng-class="vm.testConnectionStatus.css">
                                {{vm.testConnectionStatus.status}}
                            </div>
                        </div>
                    </div>


                </div>

                <div class="policy-content"
                     ng-show="vm.idsTab == 4;">
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Type
                        </div>
                        <div class="col-xs-8">
                            {{vm.newIdentitySource.type}}
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Friendly Name
                        </div>
                        <div class="col-xs-8">
                            {{vm.newIdentitySource.friendlyName}}
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Alias
                        </div>
                        <div class="col-xs-8">
                            {{vm.newIdentitySource.alias}}
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            User Base DN
                        </div>
                        <div class="col-xs-8">
                            {{vm.newIdentitySource.userBaseDN}}
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Group Base DN
                        </div>
                        <div class="col-xs-8">
                            {{vm.newIdentitySource.groupBaseDN}}
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Username
                        </div>
                        <div class="col-xs-8">
                            {{vm.newIdentitySource.username}}
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Primary Connection
                        </div>
                        <div class="col-xs-8"
                             ng-show="vm.newIdentitySource.connectionStrings && vm.newIdentitySource.connectionStrings.length > 0">
                            {{vm.newIdentitySource.connectionStrings[0]}}
                        </div>
                        <div class="col-xs-8" ng-show="!vm.newIdentitySource.connectionStrings">
                            --
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Secondary Connection
                        </div>
                        <div class="col-xs-8"
                             ng-show="vm.newIdentitySource.connectionStrings && vm.newIdentitySource.connectionStrings.length > 1">
                            {{vm.newIdentitySource.connectionStrings[1]}}
                        </div>
                        <div class="col-xs-8" ng-show="!vm.newIdentitySource.connectionStrings || vm.newIdentitySource.connectionStrings.length <= 1">
                            --
                        </div>
                    </div>
                    <div class="popup-row col-xs-12">
                        <div class="col-xs-4">
                            Certificate(s)
                        </div>
                        <div class="col-xs-8"
                             ng-show="vm.newIdentitySource.certificates && vm.newIdentitySource.certificates.length > 0">
                            <div ng-repeat="certificate in vm.newIdentitySource.certificates">
                                <button type="button"
                                        class="btn btn-link"
                                        ng-click="vm.viewCertificate(certificate)"
                                        uib-tooltip="{{certificate.metadata.subject}}"
                                        style="margin-left:-10px;word-wrap: break-word;word-break: break-all">
                                    {{
                                    certificate.metadata.subject.length> 30 ?
                                    certificate.metadata.subject.substring(0,30) + '...' :
                                    certificate.metadata.subject;
                                    }}
                                </button>
                            </div>
                            <div class="col-xs-8"
                                 ng-show="!vm.newIdentitySource.certificates || vm.newIdentitySource.certificates.length == 0">
                                --
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="popup-row col-xs-12">
                <button type="submit"
                        class="btn btn-primary pull-right btn-popup-footer"
                        ng-show="vm.idsTab == 4;">Save</button>
                <button type="button"
                        class="btn btn-primary pull-right btn-popup-footer"
                        ng-show="vm.idsTab < 4;"
                        ng-click="vm.showNextTab()"
                        ng-disabled="!vm.isValid()">Next</button>
                <button type="button"
                        class="btn btn-default pull-right btn-popup-footer"
                        ng-show="vm.canShowPreviousTab()"
                        ng-click="vm.showPreviousTab()">Back</button>
                <button type="button"
                        class="btn btn-default pull-right btn-popup-footer"
                        ng-click="closeThisDialog('cancel')">Cancel</button>
                <div ng-show="vm.isSaving">
                    <img ng-if="vm.isSaving"
                         src="../app/assets/progress.gif"
                         style="padding-right:10px;"/>
                    Saving ...
                </div>
            </div>
        </form>
    </div>
</div>