<!--

 * Copyright © 2012-2016 VMware, Inc.  All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the “License”); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an “AS IS” BASIS, without
 * warranties or conditions of any kind, EITHER EXPRESS OR IMPLIED.  See the
 * License for the specific language governing permissions and limitations
 * under the License.

-->

<div class="popup-container">
    <div class="header-20px">
        View Members for Group '{{
        vm.selectedGroup.name.length > 25 ?
        vm.selectedGroup.name.substring(0,25) + '...' :
        vm.selectedGroup.name;
        }}'
    </div>
    <div class='error' ng-show="globals.popup_errors && !globals.popup_errors.success">
        <img src="../app/assets/error.png" width="16px" height="16px"/>
        <button type="button"
                class="btn btn-xs btn-link pull-right"
                ng-click="globals.popup_errors = null;">X
        </button>
        {{globals.popup_errors.details}} {{globals.popup_errors.cause}}
    </div>
    <div class='success' ng-show="globals.popup_errors && globals.popup_errors.success">
        <img src="../app/assets/success.png" width="16px" height="16px"/>
        <button type="button"
                class="btn btn-xs btn-link pull-right"
                ng-click="globals.popup_errors = null;">X
        </button>
        {{globals.popup_errors.details}}
    </div>
    <div class="row">
        <div class="row content popup-content">
            <div class="secondary-header">
                Search Members
            </div>
            <br/>
            <form name="searchmembersform"
                  ng-submit="vm.searchMembers(vm.membersearch, vm.idsmembersearch, membersearchtype)"
                  role="searchmembersform">
                    Domain: <select
                        ng-model="vm.idsmembersearch"
                        ng-options="t as t.name for t in vm.identitysources"
                        class="ids-select"
                        ng-change="vm.getAllMembers(vm.idsmembersearch);"></select>
                    Filter: <select
                        ng-model="membersearchtype"
                        ng-options="t as t.name for t in membersearchtypes"
                        class="ids-select"></select>
                    <input type="text"
                           id="membersearch"
                           name="membersearch"
                           ng-model="vm.membersearch"
                           class="search-member-box"
                           placeholder="Search text"/> <br/><br/>
                    <button type="submit"
                            class="btn btn-primary btn-sm pull-right"
                            style="margin-right:15px;">SEARCH</button>
                    <button type="button"
                            class="btn btn-default btn-sm pull-right"
                            ng-click="vm.clearMemberSearch()"
                            style="margin-right:5px;">CLEAR</button>
                    <button type="button"
                            class="btn btn-link btn-sm pull-left"
                            ng-click="vm.addMembersToGroup()"
                            style="margin-left: 15px;">ADD MEMBER</button>
            </form>
            <div class="popup-row col-xs-12">
                <div class="large-grid">
                    <div class="large-grid-header">
                        <div class="col-xs-12">
                            Search Results
                        </div>
                    </div>
                    <div class="large-grid-content-small" style="height: 120px; overflow-y: scroll">
                        <img ng-if="vm.searchMembersLoading"
                             src="../app/assets/progress.gif"
                             style="padding:20px;"/>
                        <div ng-show="!vm.searchMembersLoading
                                && (!vm.membersearchresult.users || vm.membersearchresult.users.length == 0)
                                && (!vm.membersearchresult.groups || vm.membersearchresult.groups.length == 0)"
                             style="margin:20px;">
                            No members found. Please modify your search criteria.
                        </div>
                        <div ng-repeat="memberuser in  vm.membersearchresult.users"
                             tabindex="1"
                             class="large-grid-content-row">
                            <div class="col-xs-12">
                                <input type="checkbox"
                                       id="usersToAdd"
                                       name="usersToAdd"
                                       ng-model="memberuser.markedForAdd"
                                       class="pull-left"/>
                                <img src="../app/assets/usericon.png" width="16px" height="16px"/>
                                {{memberuser.name}}@{{memberuser.domain}}
                            </div>
                        </div>
                        <div ng-repeat="membergroup in  vm.membersearchresult.groups"
                             tabindex="1"
                             class="large-grid-content-row">
                            <div class="col-xs-12">
                                <input type="checkbox"
                                       id="groupsToAdd"
                                       name="groupsToAdd"
                                       ng-model="membergroup.markedForAdd"
                                       class="pull-left"
                                       style="margin-right:5px;"/>
                                <img src="../app/assets/group.png" width="16px" height="16px"/>
                                {{membergroup.name}}@{{membergroup.domain}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <form name="editGroupMembershipForm"
              ng-submit="vm.saveMembers()"
              role="editGroupMembershipForm">
            <div class="row content popup-content">
                <div class="secondary-header">
                    Current Members
                </div>
                <br/>
                <button type="button"
                        class="btn btn-link btn-sm pull-left btn-popup-footer"
                        style="margin-left: 10px;"
                        ng-show="vm.canDeleteSelectedMembers()"
                        ng-click="vm.deleteSelectedMembers()">DELETE
                </button>
                <button type="button"
                        class="btn btn-primary btn-sm pull-right btn-popup-footer"
                        style="margin-right: 15px;margin-left:10px;"
                        ng-click="vm.searchSelectedMembers()">SEARCH
                </button>
                <input type="text"
                       id="selectedmembersearch"
                       name="selectedmembersearch"
                       class="search-member-box"
                       ng-model="vm.selectedmembersearch"
                       placeholder="Search current members"/>
                <div class="popup-row col-xs-12">
                    <div class="large-grid">
                        <div class="large-grid-header">
                            <div class="col-xs-12">
                                Name
                            </div>
                        </div>
                        <div class="large-grid-content-small" style="height: 120px; overflow-y: scroll">
                            <img ng-if="vm.searchSelectedMembersLoading"
                                 src="../app/assets/progress.gif"
                                 style="padding:20px;"/>
                            <div ng-show="!vm.searchSelectedMembersLoading
                                && (!currentgroup.members.users || currentgroup.members.users.length == 0)
                                && (!currentgroup.members.solutionusers || currentgroup.members.solutionusers.length == 0)
                                && (!currentgroup.members.groups || currentgroup.members.groups.length == 0)"
                                 style="margin:20px;">
                                No members found.
                            </div>
                            <div ng-repeat="memberuser in  currentgroup.members.users"
                                 tabindex="1"
                                 class="large-grid-content-row"
                                 ng-show="memberuser.state != 2">
                                <div class="col-xs-12">
                                    <input type="checkbox"
                                           id="usersToDelete"
                                           name="usersToDelete"
                                           ng-model="memberuser.markedForDelete"
                                           class="pull-left"
                                           style="margin-right:5px;"/>
                                    <img src="../app/assets/usericon.png" width="16px" height="16px"/>
                                    {{memberuser.name}}@{{memberuser.domain}}
                                </div>
                            </div>
                            <div ng-repeat="membersolutionuser in  currentgroup.members.solutionusers"
                                 tabindex="1"
                                 class="large-grid-content-row">
                                <div class="col-xs-12">
                                    <span style="margin-right:15px;">
                                        <img src="../app/assets/certificate.png" width="16px" height="16px"/>
                                        {{membersolutionuser.name}}@{{membersolutionuser.domain}}
                                    </span>
                                </div>
                            </div>
                            <div ng-repeat="membergroup in  currentgroup.members.groups"
                                 tabindex="1"
                                 class="large-grid-content-row"
                                 ng-show="membergroup.state != 2">
                                <div class="col-xs-12">
                                    <input type="checkbox"
                                           id="groupsToDelete"
                                           name="groupsToDelete"
                                           ng-model="membergroup.markedForDelete"
                                           class="pull-left"
                                           style="margin-right:5px;"/>
                                    <img src="../app/assets/group.png" width="16px" height="16px"/>
                                    {{membergroup.name}}@{{membergroup.domain}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="popup-row col-xs-12">
                <button type="submit"
                        class="btn btn-primary pull-right btn-popup-footer"
                        ng-disabled="editGroupMembershipForm.$invalid || vm.disable()">SAVE
                </button>
                <button type="button"
                        class="btn btn-default pull-right btn-popup-footer"
                        ng-click="closeThisDialog('cancel')">CANCEL
                </button>
                <div ng-show="vm.isSaving">
                    <img ng-if="vm.isSaving"
                         src="../app/assets/progress.gif"
                         style="padding-right:10px;"/>
                    Saving ...
                </div>
            </div>
        </form>
    </div>
</div>